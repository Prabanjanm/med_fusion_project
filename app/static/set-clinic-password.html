<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Clinic Set Password</title>
  <style>
    /* ==== YOUR UI STYLE (UNCHANGED) ==== */
    .wrapper {
      --input-focus: #2d8cf0;
      --font-color: #323232;
      --font-color-sub: #666;
      --bg-color: #fff;
      --main-color: #323232;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .flip-card__inner {
      width: 320px;
      padding: 25px;
      background: lightgrey;
      border-radius: 6px;
      border: 2px solid var(--main-color);
      box-shadow: 4px 4px var(--main-color);
      text-align: center;
    }

    .title {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 20px;
    }

    .flip-card__input {
      width: 100%;
      height: 40px;
      margin-bottom: 15px;
      border-radius: 5px;
      border: 2px solid var(--main-color);
      padding: 5px 10px;
      font-size: 14px;
    }

    .flip-card__btn {
      width: 100%;
      height: 40px;
      border-radius: 5px;
      border: 2px solid var(--main-color);
      background: white;
      font-weight: 600;
      cursor: pointer;
    }

    .message {
      margin-top: 15px;
      font-size: 14px;
    }
  </style>
</head>

<body>
  <div class="wrapper">
    <div class="flip-card__inner">
      <div class="title">Set Clinic Password</div>

      <input
        class="flip-card__input"
        id="password"
        type="password"
        placeholder="New Password"
      />

      <input
        class="flip-card__input"
        id="confirmPassword"
        type="password"
        placeholder="Confirm Password"
      />

      <button class="flip-card__btn" onclick="setPassword()">
        Set Password
      </button>

      <div id="message" class="message"></div>
    </div>
  </div>

  <script>
    function getTokenFromURL() {
      const params = new URLSearchParams(window.location.search);
      return params.get("token");
    }

    async function setPassword() {
      const password = document.getElementById("password").value;
      const confirm = document.getElementById("confirmPassword").value;
      const message = document.getElementById("message");
      const token = getTokenFromURL();

      if (!token) {
        message.innerText = "Invalid or missing token.";
        message.style.color = "red";
        return;
      }

      if (!password || password.length < 6) {
        message.innerText = "Password must be at least 6 characters.";
        message.style.color = "red";
        return;
      }

      if (password !== confirm) {
        message.innerText = "Passwords do not match.";
        message.style.color = "red";
        return;
      }

      try {
        const res = await fetch(
          "http://127.0.0.1:8000/auth/clinic/set-password",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              token: token,
              password: password
            })
          }
        );

        const data = await res.json();

        if (!res.ok) {
          throw new Error(data.detail || "Failed to set password");
        }

        message.innerText =
          "Password set successfully. You may now log in.";
        message.style.color = "green";
      } catch (err) {
        message.innerText = err.message;
        message.style.color = "red";
      }
    }
  </script>
</body>
</html>
